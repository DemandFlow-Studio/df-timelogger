# Time Logger Tool PRD

## Introduction
The Time Logger Tool is an internal tool that automates time tracking across client projects by integrating with ClickUp. It focuses primarily on retainer-based projects in v1, providing real-time visibility into hours used versus hours allocated, eliminating the need for manual spreadsheet tracking.

## Goals
1. Eliminate manual time tracking in spreadsheets
2. Provide real-time visibility into retainer hours usage
3. Account for project lead time and execution time buffers
4. Simplify billing cycle management
5. Enable data-driven decisions about resource allocation

## User Stories
- As a project lead, I want to see how many hours have been used in the current billing cycle for each retainer client
- As a project manager, I want to track actual hours spent versus allocated hours for each client
- As an account owner, I want to export time tracking data to CSV for client reporting
- As a team member, I want to see the remaining available hours for each retainer client

## Functional Requirements

### 1. Authentication & User Management
1.1. Users must log in using Supabase Auth
1.2. Only internal team members can access the system

### 2. Client Management
2.1. Add new client with:
   - Client name
   - ClickUp list ID
   - Billing cycle start day
   - Weekly allocated hours
2.2. View list of all clients
2.3. Edit client details
2.4. Delete client

### 3. Time Tracking Integration
3.1. Sync with ClickUp API to fetch time entries
3.2. Support custom billing cycles (e.g., 13th to 13th of month)
3.3. Calculate hours based on:
   - Raw execution time from ClickUp
   - Buffer multiplier (e.g., execution time × 1.1)
   - Project lead time (e.g., +2 hours per working day)
3.4. Store time entries in database for historical tracking

### 4. Dashboard
4.1. Display all clients with:
   - Client name
   - Hours allocated for current billing cycle
   - Hours used in current cycle
   - Percentage of hours used
4.2. Allow filtering by date range
4.3. Support drilling down into individual time entries

### 5. Export
5.1. Export time tracking data to CSV format
5.2. Include all relevant fields:
   - Client name
   - Date range
   - Hours allocated
   - Hours used
   - Individual time entries

## Non-Goals (V1)
1. Fixed-budget project tracking
2. Client access/portal
3. Alert system
4. Multiple billing cycles per client
5. Manual time entry
6. Complex reporting
7. Role-based access control
8. Team Management UI (team members are managed directly in the Supabase dashboard)

## Technical Architecture

### Database Schema (Supabase)
```sql
-- Existing Clients table
create table public."Clients" (
  id bigint generated by default as identity not null,
  created_at timestamp with time zone not null default now(),
  name text null,
  clickup_list_id text null,
  billing_cycle_start_day bigint null,
  weekly_allocated_hours numeric null,
  constraint Clients_pkey primary key (id)
);

-- New TimeLogs table
create table public."TimeLogs" (
  id bigint generated by default as identity not null,
  created_at timestamp with time zone not null default now(),
  client_id bigint not null,
  clickup_task_id text null,
  start_time timestamp with time zone not null,
  duration_minutes numeric not null,
  description text null,
  constraint TimeLogs_pkey primary key (id),
  constraint TimeLogs_client_id_fkey foreign key (client_id) references public."Clients" (id)
);
```

### Tech Stack
- Frontend: React with Next.js
- UI: Tailwind CSS
- Backend: Supabase Edge Functions (Deno)
- Database: Supabase (PostgreSQL)
- Integration: ClickUp API

### User Management (V1)
ClickUp users are managed directly in the `ClickUpUsers` table in the Supabase dashboard. A UI for this is planned for a future version.

## Success Metrics
1. Zero manual spreadsheet tracking needed
2. All retainer clients tracked in system
3. Time data accuracy verified against ClickUp
4. System used daily by project leads

## Implementation Notes

### ClickUp Integration
1. Authentication:
   - Use a Personal Access Token for initial development. The token will be stored as an environment variable (`CLICKUP_PERSONAL_TOKEN`).
   - Note: This simplifies initial setup. The system can be upgraded to use OAuth 2.0 in the future for team-wide access without requiring a single shared token.

2. Time Entry Sync:
   - Fetch all time entries from specified list IDs
   - Handle pagination for large datasets
   - Store raw entries in TimeLogs table
   - Run sync 30 minutes via Edge Function, and on demand via a button in the UI

3. Hour Calculations:
   - Base hours: Sum of all time entries in billing cycle
   - Buffer: Apply 1.1x multiplier to execution time
   - Project Lead Time: Add 2 hours per working day
   - Weekly hours = (Base × Buffer) + Lead Time

### Billing Cycle Logic
1. Calculate current billing cycle:
   ```typescript
   function getBillingCycleDates(startDay: number): {start: Date, end: Date} {
     const today = new Date()
     const currentMonth = today.getMonth()
     const currentYear = today.getFullYear()
     
     let cycleStart = new Date(currentYear, currentMonth, startDay)
     if (today.getDate() < startDay) {
       cycleStart = new Date(currentYear, currentMonth - 1, startDay)
     }
     
     let cycleEnd = new Date(cycleStart)
     cycleEnd.setMonth(cycleEnd.getMonth() + 1)
     cycleEnd.setDate(cycleEnd.getDate() - 1)
     
     return { start: cycleStart, end: cycleEnd }
   }
   ```

2. Weekly hours to billing cycle hours:
   ```typescript
   const WEEKS_PER_MONTH = 4.33 // Average weeks per month
   const billingCycleHours = weeklyHours * WEEKS_PER_MONTH
   ```

## Open Questions
1. Should buffer multiplier be configurable per client?
2. How to handle project lead time for partial days?
3. Data retention policy for historical time logs?
4. How to handle time entries that span billing cycles? 